package oksconfig

#################################################################################

author  Reiner.Hauser@cern.ch Igor.Soloviev@cern.ch
manager Igor.Soloviev@cern.ch

#################################################################################

use OnlinePolicy
use config
use oks_utils
use ers

#################################################################################

apply_pattern   install_jar name=oksconfig      files=oksconfig.jar

#################################################################################

private

#################################################################################

use Boost  * TDAQCExternal
use CORAL  * TDAQExternal
use Oracle * TDAQExternal

#################################################################################

ignore_pattern inst_headers_auto

apply_pattern   build_jar name=oksconfig        src_dir=../jsrc/oksconfig	\
                                                sources=*.java

# action to generate JNI interface

macro		jni_classes			"				\
						  oksconfig.OksConfiguration	\
						  oksconfig.OksConfigObject	\
						"

macro sw.repository.java.oksconfig.jar:name        "oks config jar"
macro sw.repository.java.oksconfig.jar:description "implements config interface to oks using JNI"
macro sw.repository.java.oksconfig.jar:help.url    "http://atlas-onlsw.web.cern.ch/Atlas-onlsw/components/configdb/docs/dal/0.8/DAL.pdf"


macro		jni_class_path			"$(bin)java/oksconfig.jar:$(TDAQ_CLASSPATH)"

action          oksconfig_h         		"$(javah) -jni -classpath $(jni_class_path) -d $(bin) $(jni_classes)"

library		joksconfig			"../jsrc/oksconfig/*.cpp"
macro           joksconfig_shlibflags       	"-loksconfig -lconfig -loks"
macro           lib_joksconfig_pp_cppflags	$(jni_includes)


macro		joksconfig_dependencies		"oksconfig oksconfig_h"
macro		oksconfig_h_dependencies	oksconfig.jar

#################################################################################

library		oksconfig			OksConfiguration.cpp		\
						OksConfigObject.cpp
macro		oksconfig_shlibflags		"-lconfig -loks_utils -loks -lboost_filesystem-$(boost_libsuffix)"

library         roksconfig                      ROksConfiguration.cpp
macro           roksconfig_shlibflags           "-lroks -loksconfig"
macro           roksconfig_dependencies         "oksconfig"

#################################################################################

apply_pattern	install_libs			files="                         \
                                                 liboksconfig.so                \
                                                 libjoksconfig.so               \
                                                 libroksconfig.so               \
                                                "

#################################################################################

application	test_oksdb -group=check 	../test/test_oksdb.cpp
macro		test_oksdblinkopts		"-lconfig"
macro		test_oksdb_dependencies		oksconfig

application     test_create_oksdb               ../test/test_create_oksdb.cpp
macro           test_create_oksdblinkopts       "-lconfig"
macro           test_create_oksdb_dependencies  oksconfig

apply_pattern   build_jar name=test             src_dir="../test"		\
                                                sources=Test.java
macro		test.jar_javaflags    		"-classpath $(bin)java/oksconfig.jar:$(TDAQ_CLASSPATH)"
macro_append    test.jar_dependencies		"oksconfig.jar"


#################################################################################

apply_pattern	check_target name=a		file="../cmt/test.sh"		\
						args="$(bin)"

macro           oksconfig_check_a_dependencies	test_oksdb

#################################################################################
